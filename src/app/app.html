<div class="page">
  <div class="p-card hero-card">
    <div class="p-card-body">
      <div class="hero-grid">
        <div class="hero-text">
          <div class="badge-line">
            <span class="p-tag p-tag-rounded p-tag-primary"><i class="pi pi-bolt"></i> Prime UI + AI</span>
            <span class="free">Miễn phí</span>
          </div>
          <h1>{{ layoutTitle }}</h1>
          <p class="lead">{{ layoutDescription }}</p>

          <div class="hero-actions">
            <button class="p-button p-component p-button-primary" type="button" (click)="generatePreview()">
              <span class="p-button-icon pi pi-magic"></span>
              <span class="p-button-label">Tạo preview miễn phí</span>
            </button>
            <button class="p-button p-component p-button-outlined" type="button" (click)="resetBoard()">
              <span class="p-button-icon pi pi-refresh"></span>
              <span class="p-button-label">Làm mới</span>
            </button>
          </div>

          <div class="hero-stats">
            <div class="stat-pill">
              <i class="pi pi-images"></i>
              <span>{{ layoutSlots.length }} vùng được đánh dấu</span>
            </div>
            <div class="stat-pill">
              <i class="pi pi-check-circle"></i>
              <span>{{ completedSlots }} vùng đã đủ dữ liệu</span>
            </div>
            <div class="stat-pill">
              <i class="pi pi-sparkles"></i>
              <span>Ghép ảnh, QR & văn bản tự động</span>
            </div>
          </div>
        </div>

        <div class="hero-visual">
          <div class="layout-preview" [class.preview-on]="showPreview">
            <div class="layout-header">
              <span class="p-badge p-badge-info">Layout</span>
              <span class="file-name">{{ layoutImage }}</span>
            </div>
            <div class="slot-grid">
              <div *ngFor="let slot of layoutSlots" class="slot-card" [ngClass]="slot.status">
                <div class="slot-label">{{ slot.name }}</div>
                <div class="slot-pos">{{ slot.position }}</div>
                <div class="slot-hint">{{ slot.hint }}</div>
              </div>
            </div>
            <div class="preview-flag" *ngIf="showPreview">
              <i class="pi pi-check-circle"></i>
              Preview sẵn sàng
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid two-columns">
    <div class="col">
      <div class="p-card section-card">
        <div class="p-card-header">Ảnh layout & metadata</div>
        <div class="p-card-body">
          <div class="form-row">
            <label for="layout-upload">Tải ảnh layout</label>
            <div class="file-row">
              <input id="layout-upload" type="file" (change)="handleLayoutUpload($event)" />
              <span class="file-name">{{ layoutImage }}</span>
            </div>
          </div>

          <div class="form-row">
            <label for="layout-name">Tên layout</label>
            <input id="layout-name" type="text" class="p-inputtext" [(ngModel)]="layoutTitle" />
          </div>

          <div class="form-row">
            <label for="ai-desc">Mô tả ngắn</label>
            <textarea
              id="ai-desc"
              rows="3"
              class="p-inputtextarea"
              [(ngModel)]="layoutDescription"
              placeholder="Mô tả layout và kỳ vọng AI"
            ></textarea>
          </div>

          <div class="hint-strip">
            <i class="pi pi-info-circle"></i>
            <span>AI miễn phí vẫn hỗ trợ canh lề, cắt ghép và sinh QR dựa trên tọa độ bạn đánh dấu.</span>
          </div>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="p-card section-card">
        <div class="p-card-header">Prompt & hướng dẫn AI</div>
        <div class="p-card-body">
          <div class="form-row">
            <label for="ai-prompt">Prompt tiếng Việt</label>
            <textarea
              id="ai-prompt"
              rows="5"
              class="p-inputtextarea"
              [(ngModel)]="aiPrompt"
              placeholder="Nhập prompt mô tả cách AI ghép ảnh vào layout"
            ></textarea>
          </div>
          <ul class="note-list">
            <li *ngFor="let note of previewNotes">
              <i class="pi pi-check"></i>
              <span>{{ note }}</span>
            </li>
          </ul>
          <div class="cta-row">
            <button class="p-button p-component p-button-secondary" type="button" (click)="generatePreview()">
              <span class="p-button-icon pi pi-eye"></span>
              <span class="p-button-label">Xem preview</span>
            </button>
            <button class="p-button p-component p-button-help" type="button" (click)="resetBoard()">
              <span class="p-button-icon pi pi-shield"></span>
              <span class="p-button-label">Làm sạch trạng thái</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="p-card section-card">
    <div class="p-card-header table-header">
      <div>
        <div class="title-line">Trường cần ghép theo layout</div>
        <p class="muted">Điền dữ liệu, AI sẽ căn chỉnh chính xác vào vị trí đã đánh dấu.</p>
      </div>
      <span class="p-tag p-tag-rounded p-tag-info"><i class="pi pi-download"></i> Xuất ảnh miễn phí</span>
    </div>
    <div class="p-card-body">
      <div class="slot-table">
        <div class="slot-row slot-head">
          <span>Vùng</span>
          <span>Tọa độ</span>
          <span>Hướng dẫn</span>
          <span>Dữ liệu</span>
          <span>Trạng thái</span>
        </div>
        <div class="slot-row" *ngFor="let slot of layoutSlots">
          <div class="cell bold">{{ slot.name }}</div>
          <div class="cell">{{ slot.position }}</div>
          <div class="cell">{{ slot.hint }}</div>
          <div class="cell">
            <input
              type="text"
              class="p-inputtext"
              [ngModel]="fieldValues[slot.id]"
              (ngModelChange)="updateValue(slot.id, $event)"
              placeholder="Điền ảnh/QR/văn bản"
            />
          </div>
          <div class="cell status">
            <span class="p-tag" [ngClass]="{
              'p-tag-success': slot.status === 'ready',
              'p-tag-info': slot.status === 'auto',
              'p-tag-warning': slot.status === 'pending'
            }">
              <i class="pi" [ngClass]="{
                'pi-check-circle': slot.status === 'ready',
                'pi-compass': slot.status === 'auto',
                'pi-clock': slot.status === 'pending'
              }"></i>
              {{ slot.status === 'auto' ? 'AI tạo' : slot.status === 'ready' ? 'Sẵn sàng' : 'Chờ dữ liệu' }}
            </span>
          </div>
        </div>
      </div>

      <div class="new-slot">
        <div class="form-row inline">
          <label>Thêm vùng mới</label>
          <input type="text" class="p-inputtext" placeholder="Tên vùng" [(ngModel)]="newSlot.name" />
          <input type="text" class="p-inputtext" placeholder="Tọa độ/ghi chú" [(ngModel)]="newSlot.position" />
          <input type="text" class="p-inputtext" placeholder="Hướng dẫn" [(ngModel)]="newSlot.hint" />
          <button class="p-button p-component p-button-success" type="button" (click)="addSlot()">
            <span class="p-button-icon pi pi-plus"></span>
            <span class="p-button-label">Thêm</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="grid two-columns">
    <div class="col">
      <div class="p-card section-card">
        <div class="p-card-header">Preview ghép ảnh</div>
        <div class="p-card-body">
          <div class="preview-board" [class.preview-on]="showPreview">
            <div class="preview-bar">
              <span class="pill">Template PNG</span>
              <span class="pill">AI ghép</span>
              <span class="pill" [class.complete]="showPreview">Kiểm duyệt</span>
            </div>
            <div class="preview-canvas">
              <div class="preview-slot" *ngFor="let slot of layoutSlots" [ngClass]="slot.status">
                <div class="slot-name">{{ slot.name }}</div>
                <div class="slot-value">{{ fieldValues[slot.id] || 'Chưa có dữ liệu' }}</div>
              </div>
            </div>
            <div class="preview-footer">
              <div class="badge">
                <i class="pi pi-lock-open"></i>
                Xuất ảnh không cần tài khoản
              </div>
              <button class="p-button p-component p-button-primary" type="button" (click)="generatePreview()">
                <span class="p-button-icon pi pi-download"></span>
                <span class="p-button-label">Xuất ảnh</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="p-card section-card">
        <div class="p-card-header">Nhật ký AI</div>
        <div class="p-card-body">
          <div class="timeline" *ngFor="let log of activityLog">
            <div class="timeline-dot" [ngClass]="log.tone"></div>
            <div>
              <div class="timeline-title">{{ log.title }}</div>
              <div class="timeline-detail">{{ log.detail }}</div>
              <div class="timeline-time">{{ log.time }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
